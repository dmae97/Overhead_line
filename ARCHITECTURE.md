# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ - í•œì „ ë°°ì „ì„ ë¡œ ì—¬ìœ ìš©ëŸ‰ ìŠ¤ìºë„ˆ

> **ë²„ì „**: 0.1.0  
> **ì‘ì„±ì¼**: 2026-02-05

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ì (ì›¹ ë¸Œë¼ìš°ì €)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP (localhost:8501)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Streamlit Web Server                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ UI Layer (src/ui/)                                         â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚     â”‚
â”‚  â”‚  â”‚ sidebar   â”‚  â”‚ dashboard    â”‚  â”‚ charts    â”‚            â”‚     â”‚
â”‚  â”‚  â”‚ (ì§€ì—­ì„ íƒ) â”‚  â”‚ (ê²°ê³¼ í…Œì´ë¸”) â”‚  â”‚ (ì‹œê°í™”)  â”‚            â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚          â”‚               â”‚                 â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Service Layer (src/app.py - orchestration)                 â”‚     â”‚
â”‚  â”‚  â€¢ ì§€ì—­ ì„ íƒ â†’ API íŒŒë¼ë¯¸í„° ë³€í™˜                              â”‚     â”‚
â”‚  â”‚  â€¢ API í˜¸ì¶œ â†’ ê²°ê³¼ ì •ì œ â†’ UIì— ì „ë‹¬                          â”‚     â”‚
â”‚  â”‚  â€¢ ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ (API / Scraper fallback)                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚             â”‚                           â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Data Layer          â”‚  â”‚ Address Layer                    â”‚     â”‚
â”‚  â”‚ (src/data/)         â”‚  â”‚ (src/data/address.py)            â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚ â”‚ kepco_api.py   â”‚  â”‚  â”‚ â”‚ PublicDataReader             â”‚ â”‚     â”‚
â”‚  â”‚ â”‚ (REST Client)  â”‚  â”‚  â”‚ â”‚ pdr.code_bdong()             â”‚ â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚ pdr.code_hdong()             â”‚ â”‚     â”‚
â”‚  â”‚         â”‚           â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚ â”‚ kepco_scraper  â”‚  â”‚                                           â”‚
â”‚  â”‚ â”‚ (Selenium v2)  â”‚  â”‚  Models Layer (src/data/models.py)        â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ Pydantic Models                 â”‚     â”‚
â”‚            â”‚              â”‚  CapacityRecord, AddressParams    â”‚     â”‚
â”‚            â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            External Services                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ í•œì „ Open API      â”‚  â”‚ í•œì „ON ì›¹ì‚¬ì´íŠ¸        â”‚  â”‚
    â”‚  â”‚ bigdata.kepco.co.krâ”‚  â”‚ home.kepco.co.kr      â”‚  â”‚
    â”‚  â”‚ (REST/JSON)        â”‚  â”‚ (HTML/Selenium)       â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ë ˆì´ì–´ ìƒì„¸

### 2.1 UI Layer (`src/ui/`)

ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ë‹´ë‹¹. ë°ì´í„° ì†ŒìŠ¤ë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì•Œì§€ ëª»í•¨.

| ëª¨ë“ˆ | ì±…ì„ | Streamlit ì»´í¬ë„ŒíŠ¸ |
|------|------|-------------------|
| `sidebar.py` | ì§€ì—­ ì„ íƒ UI | `st.selectbox` (cascading) |
| `dashboard.py` | ê²°ê³¼ í…Œì´ë¸”, ìš”ì•½ í†µê³„ | `st.dataframe`, `st.metric` |
| `charts.py` | ì‹œê°í™” | `st.plotly_chart` |
| `components.py` | ì¬ì‚¬ìš© ê°€ëŠ¥ UI ìš”ì†Œ | ìƒ‰ìƒ ì½”ë”©, ìƒíƒœ ë°°ì§€ |

#### Cascading Dropdown êµ¬í˜„

```python
# sidebar.py
def render_region_selector() -> RegionInfo | None:
    """3ë‹¨ê³„ ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ì„ ë Œë”ë§í•˜ê³  ì„ íƒ ê²°ê³¼ë¥¼ ë°˜í™˜"""
    
    # 1ë‹¨ê³„: ì‹œë„ ì„ íƒ
    sido_list = get_sido_list()  # ìºì‹œë¨
    selected_sido = st.selectbox("ì‹œ/ë„", sido_list)
    
    if not selected_sido:
        return None
    
    # 2ë‹¨ê³„: ì‹œêµ°êµ¬ ì„ íƒ (ì‹œë„ì— ë”°ë¼ ë™ì  ë³€ê²½)
    sigungu_list = get_sigungu_list(selected_sido)
    selected_sigungu = st.selectbox("ì‹œ/êµ°/êµ¬", sigungu_list)
    
    if not selected_sigungu:
        return None
    
    # 3ë‹¨ê³„: ìë©´ë™ ì„ íƒ (ì‹œêµ°êµ¬ì— ë”°ë¼ ë™ì  ë³€ê²½)
    dong_list = get_dong_list(selected_sido, selected_sigungu)
    selected_dong = st.selectbox("ì/ë©´/ë™", ["ì „ì²´"] + dong_list)
    
    return RegionInfo(sido=selected_sido, sigungu=selected_sigungu, dong=selected_dong)
```

### 2.2 Service Layer (`src/app.py`)

ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë‹´ë‹¹. UI ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ Data Layerì— ìœ„ì„í•˜ê³  ê²°ê³¼ë¥¼ UIì— ì „ë‹¬.

```python
# app.py (í•µì‹¬ ë¡œì§)
def main():
    st.set_page_config(page_title="âš¡ í•œì „ ì„ ë¡œìš©ëŸ‰ ìŠ¤ìºë„ˆ", layout="wide")
    
    # 1. ì‚¬ì´ë“œë°”: ì§€ì—­ ì„ íƒ
    region = render_region_selector()
    
    if st.button("ğŸ” ì¡°íšŒ"):
        # 2. ì£¼ì†Œ â†’ API íŒŒë¼ë¯¸í„° ë³€í™˜
        params = address_service.to_kepco_params(region)
        
        # 3. API í˜¸ì¶œ
        with st.spinner(f"{region.sigungu} ì—¬ìœ ìš©ëŸ‰ ì¡°íšŒ ì¤‘..."):
            results = kepco_api.fetch_capacity(params)
        
        # 4. ê²°ê³¼ í‘œì‹œ
        render_dashboard(results)
        render_charts(results)
```

### 2.3 Data Layer (`src/data/`)

ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ í†µì‹  ë‹´ë‹¹. HTTP í˜¸ì¶œ, ì‘ë‹µ íŒŒì‹±, ì—ëŸ¬ ì²˜ë¦¬.

#### í•œì „ API í´ë¼ì´ì–¸íŠ¸ (`kepco_api.py`)

```python
class KepcoApiClient:
    """í•œì „ ì „ë ¥ë°ì´í„° ê°œë°©í¬í„¸ REST API í´ë¼ì´ì–¸íŠ¸"""
    
    BASE_URL = "https://bigdata.kepco.co.kr/openapi/v1/dispersedGeneration.do"
    
    def __init__(self, api_key: str, timeout: float = 10.0):
        self.api_key = api_key
        self.client = httpx.Client(timeout=timeout)
    
    def fetch_capacity(self, params: AddressParams) -> list[CapacityRecord]:
        """ì§€ì • ì§€ì—­ì˜ ë°°ì „ì„ ë¡œ ì—¬ìœ ìš©ëŸ‰ì„ ì¡°íšŒ"""
        response = self.client.get(
            self.BASE_URL,
            params={
                "metroCd": params.metro_cd,
                "cityCd": params.city_cd,
                "addrLidong": params.dong,
                "addrLi": params.ri,
                "addrJibun": params.jibun,
                "apiKey": self.api_key,
                "returnType": "json",
            },
        )
        response.raise_for_status()
        return [CapacityRecord(**item) for item in response.json()["data"]]
```

#### ì£¼ì†Œ ë°ì´í„° ì„œë¹„ìŠ¤ (`address.py`)

```python
class AddressService:
    """PublicDataReader ê¸°ë°˜ ì£¼ì†Œ ë°ì´í„° ê´€ë¦¬"""
    
    def __init__(self):
        self._bdong_df: pd.DataFrame | None = None
    
    @st.cache_data(ttl=86400)  # 24ì‹œê°„ ìºì‹œ
    def load_bdong_codes(_self) -> pd.DataFrame:
        """ë²•ì •ë™ì½”ë“œ ì „ì²´ ë¡œë“œ (í˜„í–‰ ë°ì´í„°ë§Œ)"""
        df = pdr.code_bdong()
        # ë§ì†Œë˜ì§€ ì•Šì€ í˜„í–‰ ì½”ë“œë§Œ í•„í„°
        return df[df["ë§ì†Œì¼ì"].isna() | (df["ë§ì†Œì¼ì"] == "")].copy()
    
    def get_sido_list(self) -> list[str]:
        """ì‹œ/ë„ ëª©ë¡ ë°˜í™˜"""
        df = self.load_bdong_codes()
        return sorted(df["ì‹œë„ëª…"].dropna().unique().tolist())
    
    def get_sigungu_list(self, sido_name: str) -> list[str]:
        """ì„ íƒí•œ ì‹œ/ë„ ë‚´ ì‹œ/êµ°/êµ¬ ëª©ë¡ ë°˜í™˜"""
        df = self.load_bdong_codes()
        filtered = df[df["ì‹œë„ëª…"] == sido_name]
        return sorted(filtered["ì‹œêµ°êµ¬ëª…"].dropna().unique().tolist())
    
    def to_kepco_params(self, region: RegionInfo) -> AddressParams:
        """ì§€ì—­ ì„ íƒ ì •ë³´ë¥¼ í•œì „ API íŒŒë¼ë¯¸í„°ë¡œ ë³€í™˜"""
        df = self.load_bdong_codes()
        row = df[
            (df["ì‹œë„ëª…"] == region.sido) & 
            (df["ì‹œêµ°êµ¬ëª…"] == region.sigungu)
        ].iloc[0]
        
        sido_cd = str(row["ì‹œë„ì½”ë“œ"]).zfill(2)
        sigungu_cd = str(row["ì‹œêµ°êµ¬ì½”ë“œ"]).zfill(5)
        
        return AddressParams(
            metro_cd=sido_cd,
            city_cd=sigungu_cd[2:],  # ë’¤ 3ìë¦¬
            dong=region.dong if region.dong != "ì „ì²´" else "",
            ri="",
            jibun="",
        )
```

---

## 3. ë°ì´í„° íë¦„

### 3.1 ì§€ì—­ ì¡°íšŒ ì‹œí€€ìŠ¤

```
ì‚¬ìš©ì          sidebar         AddressService    KepcoApiClient     í•œì „ API
  â”‚               â”‚                  â”‚                  â”‚               â”‚
  â”‚ ì‹œë„ ì„ íƒ      â”‚                  â”‚                  â”‚               â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                  â”‚               â”‚
  â”‚               â”‚ get_sido_list()  â”‚                  â”‚               â”‚
  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚               â”‚
  â”‚               â”‚ ["ì„œìš¸íŠ¹ë³„ì‹œ",...] â”‚                  â”‚               â”‚
  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚
  â”‚               â”‚                  â”‚                  â”‚               â”‚
  â”‚ ì‹œêµ°êµ¬ ì„ íƒ    â”‚                  â”‚                  â”‚               â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                  â”‚               â”‚
  â”‚               â”‚ get_sigungu_list â”‚                  â”‚               â”‚
  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚               â”‚
  â”‚               â”‚ ["ê°•ë‚¨êµ¬",...]    â”‚                  â”‚               â”‚
  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚
  â”‚               â”‚                  â”‚                  â”‚               â”‚
  â”‚ ğŸ” ì¡°íšŒ í´ë¦­  â”‚                  â”‚                  â”‚               â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                  â”‚               â”‚
  â”‚               â”‚ to_kepco_params  â”‚                  â”‚               â”‚
  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚               â”‚
  â”‚               â”‚ AddressParams    â”‚                  â”‚               â”‚
  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚               â”‚
  â”‚               â”‚                  â”‚ fetch_capacity() â”‚               â”‚
  â”‚               â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
  â”‚               â”‚                  â”‚                  â”‚ GET /openapi  â”‚
  â”‚               â”‚                  â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚               â”‚                  â”‚                  â”‚ JSON response â”‚
  â”‚               â”‚                  â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚               â”‚                  â”‚ [CapacityRecord] â”‚               â”‚
  â”‚               â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
  â”‚ ê²°ê³¼ í‘œì‹œ      â”‚                  â”‚                  â”‚               â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                  â”‚               â”‚
```

### 3.2 ìºì‹± ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Streamlit Cache                    â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ @st.cache_data(ttl=86400)               â”‚        â”‚
â”‚  â”‚ ë²•ì •ë™ì½”ë“œ DataFrame                     â”‚        â”‚
â”‚  â”‚ â€¢ ì•± ì‹œì‘ ì‹œ 1íšŒ ë¡œë“œ                     â”‚        â”‚
â”‚  â”‚ â€¢ 24ì‹œê°„ TTL                             â”‚        â”‚
â”‚  â”‚ â€¢ íŒŒìƒ: ì‹œë„ëª©ë¡, ì‹œêµ°êµ¬ëª©ë¡, ìë©´ë™ëª©ë¡     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ @st.cache_data(ttl=300)                 â”‚        â”‚
â”‚  â”‚ API ì‘ë‹µ ìºì‹œ                            â”‚        â”‚
â”‚  â”‚ â€¢ ë™ì¼ ìš”ì²­ ë°˜ë³µ ë°©ì§€                     â”‚        â”‚
â”‚  â”‚ â€¢ 5ë¶„ TTL                               â”‚        â”‚
â”‚  â”‚ â€¢ Key: (metroCd, cityCd, addrLidong)    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ st.session_state                        â”‚        â”‚
â”‚  â”‚ â€¢ í˜„ì¬ ì„ íƒëœ ì§€ì—­ ì •ë³´                   â”‚        â”‚
â”‚  â”‚ â€¢ ë§ˆì§€ë§‰ ì¡°íšŒ ê²°ê³¼                        â”‚        â”‚
â”‚  â”‚ â€¢ UI ìƒíƒœ (í¼ì¹¨/ì ‘í˜ ë“±)                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Pydantic ë°ì´í„° ëª¨ë¸

```python
from pydantic import BaseModel, Field

class AddressParams(BaseModel):
    """í•œì „ API ìš”ì²­ íŒŒë¼ë¯¸í„°"""
    metro_cd: str = Field(..., description="ì‹œë„ì½”ë“œ (2ìë¦¬)", examples=["44"])
    city_cd: str = Field(..., description="ì‹œêµ°êµ¬ì½”ë“œ ë’¤ 3ìë¦¬", examples=["131"])
    dong: str = Field(default="", description="ìë©´ë™ëª…")
    ri: str = Field(default="", description="ë™ë¦¬ëª…")
    jibun: str = Field(default="", description="ìƒì„¸ë²ˆì§€")

class CapacityRecord(BaseModel):
    """ë‹¨ì¼ ë°°ì „ì„ ë¡œ ì—¬ìœ ìš©ëŸ‰ ë ˆì½”ë“œ"""
    # ë³€ì „ì†Œ ì •ë³´
    subst_cd: str = Field(alias="substCd", description="ë³€ì „ì†Œ ì½”ë“œ")
    subst_nm: str = Field(alias="substNm", description="ë³€ì „ì†Œëª…")
    js_subst_pwr: str = Field(alias="jsSubstPwr", description="ë³€ì „ì†Œ ìš©ëŸ‰")
    subst_pwr: str = Field(alias="substPwr", description="ë³€ì „ì†Œ ëˆ„ì  ì—°ê³„ìš©ëŸ‰")
    
    # ë³€ì••ê¸° ì •ë³´
    mtr_no: str = Field(alias="mtrNo", description="ë³€ì••ê¸° ë²ˆí˜¸")
    js_mtr_pwr: str = Field(alias="jsMtrPwr", description="ë³€ì••ê¸° ìš©ëŸ‰")
    mtr_pwr: str = Field(alias="mtrPwr", description="ë³€ì••ê¸° ëˆ„ì  ì—°ê³„ìš©ëŸ‰")
    
    # DL(ë°°ì „ì„ ë¡œ) ì •ë³´
    dl_cd: str = Field(alias="dlCd", description="DL ì½”ë“œ")
    dl_nm: str = Field(alias="dlNm", description="DLëª…")
    js_dl_pwr: str = Field(alias="jsDlPwr", description="DL ìš©ëŸ‰")
    dl_pwr: str = Field(alias="dlPwr", description="DL ëˆ„ì ì—°ê³„ìš©ëŸ‰")
    
    # ì—¬ìœ ìš©ëŸ‰ (í•µì‹¬ ë°ì´í„°)
    vol1: str = Field(description="ë³€ì „ì†Œ ì—¬ìœ ìš©ëŸ‰ (kW)")
    vol2: str = Field(description="ë³€ì••ê¸° ì—¬ìœ ìš©ëŸ‰ (kW)")
    vol3: str = Field(description="DL ì—¬ìœ ìš©ëŸ‰ (kW)")
    
    @property
    def substation_capacity(self) -> int:
        """ë³€ì „ì†Œ ì—¬ìœ ìš©ëŸ‰ (ì •ìˆ˜)"""
        return int(self.vol1) if self.vol1 else 0
    
    @property
    def transformer_capacity(self) -> int:
        """ë³€ì••ê¸° ì—¬ìœ ìš©ëŸ‰ (ì •ìˆ˜)"""
        return int(self.vol2) if self.vol2 else 0
    
    @property
    def dl_capacity(self) -> int:
        """DL ì—¬ìœ ìš©ëŸ‰ (ì •ìˆ˜)"""
        return int(self.vol3) if self.vol3 else 0
    
    @property
    def min_capacity(self) -> int:
        """3ê°€ì§€ ì—¬ìœ ìš©ëŸ‰ ì¤‘ ìµœì†Œê°’ (ì‹¤ì§ˆì  ì—°ê³„ê°€ëŠ¥ ìš©ëŸ‰)"""
        return min(self.substation_capacity, self.transformer_capacity, self.dl_capacity)
    
    @property
    def is_connectable(self) -> bool:
        """ì—°ê³„ ê°€ëŠ¥ ì—¬ë¶€ (ëª¨ë“  ì—¬ìœ ìš©ëŸ‰ > 0)"""
        return self.min_capacity > 0

class CapacityResponse(BaseModel):
    """í•œì „ API ì‘ë‹µ ì „ì²´"""
    data: list[CapacityRecord] = Field(default_factory=list)

class RegionInfo(BaseModel):
    """ì‚¬ìš©ì ì§€ì—­ ì„ íƒ ì •ë³´"""
    sido: str = Field(description="ì‹œë„ëª…")
    sigungu: str = Field(description="ì‹œêµ°êµ¬ëª…")
    dong: str = Field(default="ì „ì²´", description="ìë©´ë™ëª…")
```

---

## 5. ì—ëŸ¬ í•¸ë“¤ë§ ì „ëµ

### 5.1 ì—ëŸ¬ ê³„ì¸µ

```python
# src/core/exceptions.py

class OverheadLineError(Exception):
    """ì•± ì „ì²´ ê¸°ë³¸ ì˜ˆì™¸"""
    pass

class KepcoAPIError(OverheadLineError):
    """í•œì „ API ê´€ë ¨ ì—ëŸ¬"""
    def __init__(self, message: str, status_code: int | None = None):
        self.message = message
        self.status_code = status_code
        super().__init__(self.message)

class AddressDataError(OverheadLineError):
    """ì£¼ì†Œ ë°ì´í„° ê´€ë ¨ ì—ëŸ¬"""
    pass

class ScraperError(OverheadLineError):
    """Selenium ìŠ¤í¬ë˜í•‘ ê´€ë ¨ ì—ëŸ¬ (v2)"""
    pass
```

### 5.2 ì—ëŸ¬ ì²˜ë¦¬ íë¦„

```
API í˜¸ì¶œ ì‹¤íŒ¨
    â”œâ”€ HTTP 4xx â†’ KepcoAPIError("ì¸ì¦ ì˜¤ë¥˜" / "ì˜ëª»ëœ ìš”ì²­")
    â”œâ”€ HTTP 5xx â†’ KepcoAPIError("ì„œë²„ ì˜¤ë¥˜") â†’ retry (3íšŒ)
    â”œâ”€ Timeout  â†’ KepcoAPIError("íƒ€ì„ì•„ì›ƒ") â†’ retry (3íšŒ)
    â”œâ”€ ë„¤íŠ¸ì›Œí¬ â†’ KepcoAPIError("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜")
    â””â”€ íŒŒì‹± ì‹¤íŒ¨ â†’ KepcoAPIError("ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜")

ëª¨ë“  ì—ëŸ¬ â†’ st.error() + ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€
```

### 5.3 Retry ì •ì±…

```python
import tenacity

@tenacity.retry(
    stop=tenacity.stop_after_attempt(3),
    wait=tenacity.wait_exponential(multiplier=1, min=1, max=10),
    retry=tenacity.retry_if_exception_type(httpx.TimeoutException),
    before_sleep=lambda retry_state: logger.warning(
        f"Retry {retry_state.attempt_number}/3..."
    ),
)
def fetch_with_retry(self, params: dict) -> dict:
    """ì¬ì‹œë„ ë¡œì§ì´ í¬í•¨ëœ API í˜¸ì¶œ"""
    ...
```

---

## 6. ë°°í¬ ì•„í‚¤í…ì²˜

### 6.1 ë¡œì»¬ ê°œë°œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ê°œë°œì PC       â”‚
â”‚                  â”‚
â”‚  Python 3.11+    â”‚
â”‚  uv / venv       â”‚
â”‚  streamlit run   â”‚
â”‚  localhost:8501   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Docker ë°°í¬

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# ì˜ì¡´ì„± ì„¤ì¹˜
COPY pyproject.toml .
RUN pip install uv && uv sync --no-dev

# ì†ŒìŠ¤ ë³µì‚¬
COPY src/ src/

# Streamlit í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8501

# í—¬ìŠ¤ì²´í¬
HEALTHCHECK CMD curl -f http://localhost:8501/_stcore/health

# ì‹¤í–‰
CMD ["streamlit", "run", "src/app.py", \
     "--server.port=8501", \
     "--server.address=0.0.0.0", \
     "--browser.gatherUsageStats=false"]
```

### 6.3 Streamlit Cloud ë°°í¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Repo     â”‚â”€â”€â”€â”€>â”‚ Streamlit Cloud  â”‚
â”‚  (main branch)   â”‚     â”‚ streamlit.io     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ Auto-deploy      â”‚
                        â”‚ Secrets Manager  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- API KeyëŠ” Streamlit Cloudì˜ **Secrets** ê¸°ëŠ¥ìœ¼ë¡œ ê´€ë¦¬
- `requirements.txt` í•„ìˆ˜ (Streamlit CloudëŠ” pyproject.toml ë¯¸ì§€ì›)

---

## 7. ì§€ë²ˆ ì£¼ì†Œ ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜ (v2 - Selenium)

### 7.1 ë¬¸ì œ ì •ì˜

APIë¡œ ì¡°íšŒ ì‹œ `addrLidong` (ë™/ë©´)ê¹Œì§€ëŠ” ì¡°íšŒ ê°€ëŠ¥í•˜ë‚˜, íŠ¹ì • ì§€ë²ˆì˜ **ì •í™•í•œ ë°°ì „ì„ ë¡œ** ë§¤í•‘ì´ í•„ìš”í•œ ê²½ìš° í•œì „ON ì‚¬ì´íŠ¸ì˜ ì§€ë²ˆ ê²€ìƒ‰ì´ í•„ìš”.

### 7.2 ì•Œê³ ë¦¬ì¦˜

```python
class JibunSearchAlgorithm:
    """ë²•ì •ë™ ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ì§€ë²ˆ ì£¼ì†Œ ìƒì„± ë° ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜"""
    
    def generate_search_queries(self, region: RegionInfo) -> list[str]:
        """ì§€ì—­ ë‚´ ëª¨ë“  ë²•ì •ë™ì— ëŒ€í•œ ê²€ìƒ‰ ì¿¼ë¦¬ ìƒì„±
        
        ì „ëµ:
        1. PublicDataReaderì—ì„œ í•´ë‹¹ ì‹œêµ°êµ¬ì˜ ëª¨ë“  ë²•ì •ë™(ìë©´ë™+ë™ë¦¬ëª…) ì¶”ì¶œ
        2. ê° ë²•ì •ë™ì— ëŒ€í•´ "ëŒ€í‘œ ë²ˆì§€(1ë²ˆì§€)"ë¥¼ ì¡°í•©
        3. 1ë²ˆì§€ê°€ ì—†ìœ¼ë©´ ì‚°1ë²ˆì§€, ê·¸ë˜ë„ ì—†ìœ¼ë©´ ë™ì‚¬ë¬´ì†Œ ì£¼ì†Œ ì‚¬ìš©
        """
        bdong_df = address_service.load_bdong_codes()
        
        # í•´ë‹¹ ì‹œêµ°êµ¬ì˜ ë²•ì •ë™ í•„í„°ë§
        filtered = bdong_df[
            (bdong_df["ì‹œë„ëª…"] == region.sido) &
            (bdong_df["ì‹œêµ°êµ¬ëª…"] == region.sigungu) &
            (bdong_df["ë§ì†Œì¼ì"].isna())
        ]
        
        queries = []
        for _, row in filtered.iterrows():
            base_addr = f"{row['ì‹œë„ëª…']} {row['ì‹œêµ°êµ¬ëª…']}"
            
            if pd.notna(row["ìë©´ë™ëª…"]) and row["ìë©´ë™ëª…"]:
                base_addr += f" {row['ìë©´ë™ëª…']}"
            
            if pd.notna(row["ë™ë¦¬ëª…"]) and row["ë™ë¦¬ëª…"]:
                base_addr += f" {row['ë™ë¦¬ëª…']}"
            
            # ëŒ€í‘œ ë²ˆì§€ ì¡°í•©
            queries.append(f"{base_addr} 1")
        
        return queries
    
    def scan_region(self, region: RegionInfo, progress_callback=None):
        """ì§€ì—­ ì „ì²´ ìŠ¤ìº” (Selenium ê¸°ë°˜)"""
        queries = self.generate_search_queries(region)
        results = []
        
        for i, query in enumerate(queries):
            try:
                result = self._search_kepco_on(query)
                results.append(result)
            except ScraperError as e:
                results.append({"query": query, "error": str(e)})
            
            if progress_callback:
                progress_callback((i + 1) / len(queries))
            
            # ë´‡ íƒì§€ ë°©ì§€ ë”œë ˆì´
            time.sleep(random.uniform(2.0, 5.0))
        
        return results
```

### 7.3 í•œì „ON ì‚¬ì´íŠ¸ ìŠ¤í¬ë˜í•‘ íë¦„

```
1. headless Chrome ì‹¤í–‰
2. í•œì „ON ì ‘ì†ê°€ëŠ¥ ìš©ëŸ‰ì¡°íšŒ í˜ì´ì§€ ë¡œë“œ
   â†’ https://home.kepco.co.kr/kepco/CO/H/E/COHEPP001/COHEPP00110.do?menuCd=FN420106
3. "ì§€ë²ˆ(ì£¼ì†Œ)ìœ¼ë¡œ ê²€ìƒ‰" íƒ­ ì„ íƒ
4. ê²€ìƒ‰ì°½ì— ì£¼ì†Œ ì…ë ¥ (ì˜ˆ: "ì¶©ì²­ë‚¨ë„ ì²œì•ˆì‹œ ì„œë¶êµ¬ ë¶ˆë‹¹ë™ 1")
5. ê²€ìƒ‰ ì‹¤í–‰ (Enter ë˜ëŠ” ê²€ìƒ‰ ë²„íŠ¼)
6. ì£¼ì†Œ ê²€ìƒ‰ ê²°ê³¼ ëª©ë¡ì—ì„œ ì²« ë²ˆì§¸ í•­ëª© ì„ íƒ
7. ê²°ê³¼ í…Œì´ë¸”ì—ì„œ ë³€ì „ì†Œ/ë³€ì••ê¸°/DL ì—¬ìœ ìš©ëŸ‰ íŒŒì‹±
8. ê²°ê³¼ ì €ì¥ í›„ ë‹¤ìŒ ë²•ì •ë™ìœ¼ë¡œ ì´ë™
```

---

## 8. ì„±ëŠ¥ ìµœì í™”

### 8.1 API í˜¸ì¶œ ìµœì í™”

| ì „ëµ | ì„¤ëª… | íš¨ê³¼ |
|------|------|------|
| **ë ˆë²¨ë³„ ì¡°íšŒ** | ì‹œêµ°êµ¬ ë‹¨ìœ„ë¡œ í•œ ë²ˆì— ì¡°íšŒ (ë™/ë¦¬ ë¯¸ì§€ì •) | API í˜¸ì¶œ 1íšŒë¡œ ì „ì²´ DL ëª©ë¡ |
| **ìºì‹±** | ë™ì¼ ìš”ì²­ 5ë¶„ ìºì‹œ | ë°˜ë³µ ì¡°íšŒ ì œê±° |
| **ë°°ì¹˜ ë”œë ˆì´** | ì—°ì† í˜¸ì¶œ ì‹œ 1ì´ˆ ë”œë ˆì´ | ì„œë²„ ë¶€í•˜ ë°©ì§€ |

### 8.2 Streamlit ìµœì í™”

| ì „ëµ | ì„¤ëª… |
|------|------|
| `st.cache_data` | ë²•ì •ë™ ì½”ë“œ, API ì‘ë‹µ ìºì‹± |
| `st.fragment` | ë¶€ë¶„ ë¦¬ë Œë”ë§ (Streamlit 1.33+) |
| `st.session_state` | ìƒíƒœ ìœ ì§€ (ì„ íƒê°’, ê²°ê³¼) |
| Lazy loading | ì‹œêµ°êµ¬/ìë©´ë™ ëª©ë¡ì€ ìƒìœ„ ì„ íƒ ì‹œì—ë§Œ ë¡œë“œ |

---

## 9. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

| í•­ëª© | ëŒ€ì‘ |
|------|------|
| API Key ë…¸ì¶œ | `.env` + `.gitignore`, Streamlit Secrets |
| HTTPS | í•œì „ APIëŠ” ì´ë¯¸ HTTPS |
| ì…ë ¥ ê²€ì¦ | Pydantic ëª¨ë¸ë¡œ ëª¨ë“  ì…ë ¥/ì¶œë ¥ ê²€ì¦ |
| Rate Limiting | ìš”ì²­ ê°„ ë”œë ˆì´, ì¼ì¼ í˜¸ì¶œëŸ‰ ëª¨ë‹ˆí„°ë§ |
| ê°œì¸ì •ë³´ | ìˆ˜ì§‘/ì €ì¥í•˜ì§€ ì•ŠìŒ (ì£¼ì†Œ ê²€ìƒ‰ë§Œ) |
